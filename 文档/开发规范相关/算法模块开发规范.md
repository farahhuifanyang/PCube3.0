<!--
 * @Author: your name
 * @Date: 2021-04-07 14:36:43
 * @LastEditTime: 2021-04-07 16:41:54
 * @LastEditors: Please set LastEditors
 * @Description: In User Settings Edit
 * @FilePath: /PCube3.0/文档/开发规范相关/算法模块开发规范.md
-->
# 算法部分开发规范
本文将规定使用python撰写的算法模块部分在配置，编码，封装时需要注意的规范

重要部分大体的规范如下图给出，望其他开发者与维护者在编码过程中留意

![算法部分开发规范](算法模块开发规范.md)

## 1. 封装规范
### 1.1 代码部分
所有的python代码应该放在 PCube3.0/coreNLP 目录下，每个算法在此单独建立一个目录

目录由算法的简写命名，如NER(实体识别) ORE(开放关系抽取) SUM(摘要) PER(人格) SA(情感分析)

目录下应该包含以下几个文件:
```
config.py 定义模型的配置，这里仅保留不允许被用户修改的部分
dataParser.py 定义将输入数据转化为Tensor矩阵的函数，最好是重写torch的Dataset类
main.py 定义算法接口类，继承coreNLP.Algorithm基类，类命名规则参考下文。在初始化时构建并加载模型，用run方法执行算法核心处理，输入输出参考详细设计的接口定义
model.py 算法模型的定义，应该与训练模型时的定义相同
```

#### 1.2 模型及其他文件
模型及其他文件统一放在 PCube3.0/models 目录下，每个算法在此单独建立一个目录

目录下至少应该有模型文件，命名随意，但最好能体现时间，以备后续迭代使用

## 2. 命名规范
### 2.1 全局配置参数
#### 适用范围
全局配置参数指仅有用户或者未来项目迁移时需要根据新环境自定义配置的变量

如: 算法运行时使用的GPU设备号，一次性处理的数据条数，模型文件路径等

#### 规范 
于PCube3.0根目录下的configure.py中定义全局使用的变量

同一个算法模块的配置需要放在一起，且需要在第一行注释对应的算法，不同算法的配置相隔一个空行

配置变量的命名规范为 【算法模块大写简写】_name_of_para

功能相同的变量尽量参考其他算法的名称命名，特殊的变量需要在末尾添加注释

#### 示例
```
# entity recognition configs     请根据实际需要配置
self.NER_model_path = 'models/NER/03-24-16.pkl'  # NER模型的存放位置
self.NER_pos_path = 'models/NER/pos_map.json'  # NER使用的pos映射表的存放位置
self.NER_cuda_visible_devices = 0      # 配置GPU设备号 -1 表示使用CPU 下同
self.NER_batch_size = 30    # 应该根据模型本身的显存占用量和数据的占用量综合计算
```

### 2.2 文件命名
#### 适用范围
所有的python文件
#### 规范 
数据类型定义文件需要与数据类型名称相同，使用大驼峰命名法：变量名的每个单词首字母大写，单词之间没有间隔

其余小驼峰命名法：变量名中除第一个单词之外，其他单词首字母大写，单词之间没有间隔

文件的命名应该尽可能体现文件内所定义的函数的作用
#### 示例
```
classes/Article.py # 定义文章类
preprocess/forAnnotation.py    # 定义对标注数据的预处理函数
```

### 2.3 类的命名
#### 适用范围
所有的python类
#### 规范 
大驼峰命名法：变量名的每个单词首字母大写，单词之间没有间隔

对基本数据结构类的命名应该与本项目的设计文档定义的名称/数据库表的名称相同

对功能接口型类的命名应该体现其主要功能，并以拟人化名称命名
#### 示例
```
classes.Article.Article # 定义文章类
preprocess.LTPtagger.LTPtagger    # 定义使用LTP进行语法语义标注的接口
coreNLP.NER.main.EntityRecognizer    # 定义执行实体识别的接口
```

### 2.4 函数/方法的命名
#### 适用范围
所有python函数、类的方法
#### 规范 
小驼峰命名法：变量名中除第一个单词之外，其他单词首字母大写，单词之间没有间隔

对函数或方法的命名应该能够简要说明该函数或方法的功能
#### 示例
```
preprocess.forAnnotation.randomSample # 随机采样文章组成标注数据
```

### 2.5 变量/属性的命名
#### 适用范围
代码中声明的所有变量，类的属性
#### 规范 
下滑线分隔法：对于变量名中的单词，用下划线进行分隔

变量或属性命名应该尽可能符合它所保存的数据意义

## 3. 注释规范
#### 3.1 函数的注释
建议使用 Python Docstring Generator，在函数内部敲击三次双引号自动产生注释模板

如不使用，则也需要在双引号内部保留以下内容：

- 函数的作用
- 函数输入参数的类型、格式、描述
- 函数返回的数据类型、格式、描述

#### 3.2 其它的注释
在复杂函数的必要位置增加必要的注释，以 "#" 注释表示

"#" 距离行尾至少2个空格，注释的文字距离 "#"一个空格